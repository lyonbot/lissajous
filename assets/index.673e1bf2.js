var F=Object.defineProperty;var U=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var L=(t,e,s)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,z=(t,e)=>{for(var s in e||(e={}))O.call(e,s)&&L(t,s,e[s]);if(U)for(var s of U(e))$.call(e,s)&&L(t,s,e[s]);return t};var u=(t,e,s)=>(L(t,typeof e!="symbol"?e+"":e,s),s);import{d as j,r as B,a as A,b as N,o as V,c as x,p as E,w as q,e as w,f as n,t as I,g as H,h as y,v as P,i as R,j as T,k as d,l as k,m as X}from"./vendor.71626719.js";const Y=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}};Y();const C=Array.from({length:256},(t,e)=>Math.log2(1+e/255)),J=t=>C[t],K=t=>t>=128?C[t-128<<1]:-C[128-t<<1],W=t=>t<=200?50:t<=240?50+(t-200)*(20/40):t<=280?70:t<=350?70-(t-280)*(20/70):50;class G{constructor(e,s){u(this,"canvas");u(this,"ctx");u(this,"width");u(this,"height");u(this,"analyserLeft");u(this,"bufferLeft");u(this,"analyserRight");u(this,"bufferRight");u(this,"sampleRate");u(this,"_fftSize");u(this,"lastDrawAt",0);u(this,"currentHue",0);u(this,"graphSize",0);u(this,"graphCenterX",0);u(this,"graphCenterY",0);u(this,"fadeInterval",.2);u(this,"hueSpeed",40);u(this,"rotate45Deg",!0);u(this,"sampleSource","wave");u(this,"enableLog2",!0);u(this,"gain",1);u(this,"paintMode","lissajous");u(this,"drawFrame",()=>{const e=Date.now(),s=(e-this.lastDrawAt)/1e3;this.lastDrawAt=e,requestAnimationFrame(this.drawFrame);const{ctx:o,canvas:i}=this;let l=this.prepareData(this.analyserLeft,this.bufferLeft),a=this.prepareData(this.analyserRight,this.bufferRight),g=l.length;this.gain!==1&&(l=l.map(r=>r*this.gain),a=a.map(r=>r*this.gain));const _=Math.min(s/this.fadeInterval,1);o.fillStyle=`rgba(0, 0, 0, ${_})`,o.fillRect(0,0,i.width,i.height),this.currentHue=(this.currentHue+s*this.hueSpeed)%360;const b=Math.round(this.currentHue),v=`hsla(${b}, 100%, ${W(b)}%, `;if(o.lineWidth=1/this.graphSize,o.translate(this.graphCenterX,this.graphCenterY),o.scale(this.graphSize,this.graphSize),this.rotate45Deg&&(o.rotate(-Math.PI/4),o.scale(.7071,.7071)),this.paintMode==="lissajous"){const r=10,p=Math.ceil(this.sampleRate*(Math.max(this.fadeInterval,.1)/(100/r)));let h=0,c=0;for(let f=g-1;f>=0;f--){let m=l[f]/2,S=a[f]/2;if(c===0){const M=100-h*r;if(M<=0)break;o.strokeStyle=`${v}${M}%)`,o.beginPath(),o.moveTo(m,S)}else o.lineTo(m,S);++c>=p&&(o.stroke(),f++,h++,c=0)}o.stroke()}if(this.paintMode==="wave-shape"){o.strokeStyle=`${v}100%)`,o.beginPath();for(let r=0;r<=g-1;r++){let p=r/g-.5,h=-l[r]/4-.25;o[r===0?"moveTo":"lineTo"](p,h)}o.stroke(),o.beginPath();for(let r=0;r<=g-1;r++){let p=r/g-.5,h=-a[r]/4+.25;o[r===0?"moveTo":"lineTo"](p,h)}o.stroke()}if(this.paintMode==="disc"){const r=.25,p=.25,h=(c,f)=>{const m=Math.PI*2*c,S=-Math.sin(m),M=-Math.cos(m),D=r+f*p;o.moveTo(r*M,r*S),o.lineTo(D*M,D*S)};o.strokeStyle=`${v}100%)`,o.beginPath();for(let c=0;c<=g-1;c++)h(c/(g-1)/2,l[c]),h(1-c/(g-1)/2,a[c]);o.stroke()}o.resetTransform()});this.analyserLeft=e,this.analyserRight=s,this.fftSize=1024}get fftSize(){return this._fftSize}set fftSize(e){if(e===this._fftSize)return;const{analyserLeft:s,analyserRight:o}=this;s.fftSize=o.fftSize=e,s.smoothingTimeConstant=o.smoothingTimeConstant=.9;var i=s.frequencyBinCount;this._fftSize=e,this.sampleRate=s.context.sampleRate,this.bufferLeft=new Uint8Array(i),this.bufferRight=new Uint8Array(i)}initCanvas(e){this.canvas=e,this.ctx=e.getContext("2d"),this.width=e.width,this.height=e.height,this.graphSize=Math.min(this.width,this.height),this.graphCenterX=this.width/2,this.graphCenterY=this.height/2}prepareData(e,s){return this.sampleSource==="wave"?(e.getByteTimeDomainData(s),Array.from(s,this.enableLog2?K:o=>(o-128)/128)):(e.getByteFrequencyData(s),Array.from(s,this.enableLog2?o=>o/128-1:o=>J(o)*2-1))}}var Q="./assets/FluffingADuck.cb23b183.mp3";var Z=(t,e)=>{const s=t.__vccOpts||t;for(const[o,i]of e)s[o]=i;return s};const ee=j({name:"App",setup(){const t=B(),e=A({sampleRate:0,fileName:"Click to Open a Music",fileUrl:""}),s=c=>{const f=c.target,m=f.files[0];f.value="",m?r(URL.createObjectURL(m),m.name):r("","")},o=()=>{r(Q,"Kevin MacLeod: Fluffing a Duck.mp3")},i=new N,l=document.createElement("audio"),a=i.createMediaElementSource(l),g=i.destination;V(()=>{l.pause(),i.close()}),a.connect(g);const _=i.createChannelSplitter(2),b=i.createAnalyser(),v=i.createAnalyser();a.connect(_),_.connect(b,0),_.connect(v,1),window.audio=l,l.addEventListener("play",()=>{e.sampleRate=i.sampleRate},!1);const r=(c,f)=>{try{URL.revokeObjectURL(e.fileUrl)}catch{}return c?(e.fileUrl=c,e.fileName=f,l.src=c,l.load(),i.resume().then(()=>l.play()).then(()=>!0).catch(m=>(console.error("Cannot auto start: ",m),!1))):(e.fileUrl="",e.fileName="Click to Open a Music",Promise.resolve(!1))},p=new G(b,v);x(()=>{p.initCanvas(t.value),p.drawFrame()});const h=A(E(p,["rotate45Deg","hueSpeed","fadeInterval","fftSize","sampleSource","enableLog2","gain","paintMode"]));q(h,c=>{Object.assign(p,c),history.replaceState(z({},c),"",`#${encodeURIComponent(JSON.stringify(c))}`)},{deep:!0});try{Object.assign(h,JSON.parse(decodeURIComponent(location.hash.slice(1))))}catch{}return{loadSampleMusic:o,handleFileSelect:s,canvas:t,painter:p,options:h,sysInfo:e}}}),te={tabindex:"0",role:"button",class:"selectMusic"},oe={class:"loadSampleMusicLine"},ne={class:"options"},se=d("Rotate Image 45\xB0"),ie=d("color shifting "),ae=d("deg/sec"),le=d("frame persist "),re=d("sec"),ue=["value"],ce=n("option",null,"128",-1),pe=n("option",null,"256",-1),he=n("option",null,"512",-1),de=n("option",null,"1024",-1),fe=n("option",null,"2048",-1),me=n("option",null,"4096",-1),ge=n("option",null,"8192",-1),ye=[ce,pe,he,de,fe,me,ge],ve=d(" samples per frame "),_e=d("sample from "),be=n("option",null,"wave",-1),Se=n("option",{value:"fft"},"fft (just for fun)",-1),Me=[be,Se],Le=d(" y = "),we={key:0},Re=d("log"),ke=n("sub",null,"2",-1),Ce=d("(1 + x)"),De=[Re,ke,Ce],Ue={key:1},ze=d(" * "),Ae=d("gain "),Ie=d("paintMode "),Pe=n("option",null,"lissajous",-1),Te=n("option",null,"wave-shape",-1),Fe=n("option",null,"disc",-1),Oe=[Pe,Te,Fe],$e={ref:"canvas",width:"800",height:"800"};function je(t,e,s,o,i,l){return k(),w("div",null,[n("div",te,[n("div",null,I(t.sysInfo.fileName),1),n("input",{type:"file",onChange:e[0]||(e[0]=(...a)=>t.handleFileSelect&&t.handleFileSelect(...a)),accept:"audio/*",class:"actualFileInput"},null,32)]),n("div",oe,[n("a",{href:"#",onClick:e[1]||(e[1]=H((...a)=>t.loadSampleMusic&&t.loadSampleMusic(...a),["prevent"]))},"\u{1F3BA} Load Sample Music")]),n("div",ne,[n("label",null,[y(n("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>t.options.rotate45Deg=a)},null,512),[[P,t.options.rotate45Deg]]),se]),n("label",null,[ie,y(n("input",{type:"number",min:"0",max:"100","onUpdate:modelValue":e[3]||(e[3]=a=>t.options.hueSpeed=a)},null,512),[[R,t.options.hueSpeed,void 0,{number:!0,lazy:!0}]]),ae]),n("label",null,[le,y(n("input",{type:"number",min:"0",max:"5",step:"0.05","onUpdate:modelValue":e[4]||(e[4]=a=>t.options.fadeInterval=a)},null,512),[[R,t.options.fadeInterval,void 0,{number:!0,lazy:!0}]]),re]),n("label",null,[n("select",{onChange:e[5]||(e[5]=a=>t.options.fftSize=+a.target.value),value:String(t.options.fftSize)},ye,40,ue),ve]),n("label",null,[_e,y(n("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>t.options.sampleSource=a)},Me,512),[[T,t.options.sampleSource]])]),n("div",null,[n("label",null,[Le,y(n("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=a=>t.options.enableLog2=a)},null,512),[[P,t.options.enableLog2]]),t.options.enableLog2?(k(),w("span",we,De)):(k(),w("span",Ue,"x"))]),ze,n("label",null,[Ae,y(n("input",{type:"number",min:"0",max:"5",step:"0.2","onUpdate:modelValue":e[8]||(e[8]=a=>t.options.gain=a)},null,512),[[R,t.options.gain,void 0,{number:!0,lazy:!0}]])])]),n("label",null,[Ie,y(n("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>t.options.paintMode=a)},Oe,512),[[T,t.options.paintMode]])]),n("label",null," sampleRate: "+I(t.sysInfo.sampleRate),1)]),n("canvas",$e,null,512)])}var Be=Z(ee,[["render",je]]);const Ne=X(Be);Ne.mount("#app");
