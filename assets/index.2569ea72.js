var A=Object.defineProperty;var k=(t,e,i)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var a=(t,e,i)=>(k(t,typeof e!="symbol"?e+"":e,i),i);import{d as z,r as R,a as T,o as M,b as P,c as y,e as s,t as V,w as g,v as C,f as w,g as $,h as u,i as v,j as B}from"./vendor.978632b8.js";const O=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}};O();const U=Array.from({length:256},(t,e)=>Math.log2(1+e/255)),j=t=>U[t],I=t=>t>=128?U[t-128<<1]:-U[128-t<<1];class N{constructor(e,i){a(this,"canvas");a(this,"ctx");a(this,"width");a(this,"height");a(this,"analyserLeft");a(this,"bufferLeft");a(this,"analyserRight");a(this,"bufferRight");a(this,"fftSize",1024);a(this,"lastDrawAt",0);a(this,"currentHue",0);a(this,"graphSize",0);a(this,"graphCenterX",0);a(this,"graphCenterY",0);a(this,"fadeInterval",.2);a(this,"hueSpeed",40);a(this,"rotate45Deg",!0);a(this,"sampleSource","wave");a(this,"enableLog2",!0);a(this,"gain",1);a(this,"drawFrame",()=>{const e=Date.now(),i=(e-this.lastDrawAt)/1e3;this.lastDrawAt=e,requestAnimationFrame(this.drawFrame);const{ctx:n,canvas:o}=this;let l=this.prepareData(this.analyserLeft,this.bufferLeft),r=this.prepareData(this.analyserRight,this.bufferRight),d=l.length;this.gain!==1&&(l=l.map(h=>h*this.gain),r=r.map(h=>h*this.gain));const _=Math.min(i/this.fadeInterval,1);n.fillStyle=`rgba(0, 0, 0, ${_})`,n.fillRect(0,0,o.width,o.height),n.lineWidth=1,this.currentHue=(this.currentHue+i*this.hueSpeed)%360;const b=Math.round(this.currentHue),S=this.rotate45Deg?this.graphSize/1.414:this.graphSize;n.strokeStyle=`hsl(${b}, 100%, 50%)`,n.translate(this.graphCenterX,this.graphCenterY),this.rotate45Deg&&n.rotate(-45),n.beginPath();for(let h=0;h<d;h++){let L=l[h]/2*S,F=r[h]/2*S;const D=h==0?"moveTo":"lineTo";n[D](L,F)}n.stroke(),n.resetTransform();for(const[h,L]of[]){n.strokeStyle=L,n.beginPath();for(var m=o.width*1/d,c=0,p=0;p<d;p++){var f=(2-h[p])/2*o.height;p===0?n.moveTo(c,f):n.lineTo(c,f),c+=m}n.stroke()}});this.analyserLeft=e,this.analyserRight=i,this.setFFTSize(1024)}setFFTSize(e){const{analyserLeft:i,analyserRight:n}=this;i.fftSize=n.fftSize=e,i.smoothingTimeConstant=n.smoothingTimeConstant=.9;var o=i.frequencyBinCount;this.fftSize=e,this.bufferLeft=new Uint8Array(o),this.bufferRight=new Uint8Array(o)}initCanvas(e){this.canvas=e,this.ctx=e.getContext("2d"),this.width=e.width,this.height=e.height,this.graphSize=Math.min(this.width,this.height),this.graphCenterX=this.width/2,this.graphCenterY=this.height/2}prepareData(e,i){return this.sampleSource==="wave"?(e.getByteTimeDomainData(i),Array.from(i,this.enableLog2?I:n=>(n-128)/128)):(e.getByteFrequencyData(i),Array.from(i,this.enableLog2?n=>n/128-1:n=>j(n)*2-1))}}var q=(t,e)=>{const i=t.__vccOpts||t;for(const[n,o]of e)i[n]=o;return i};const E=z({name:"App",setup(){const t=R(null),e=R(),i=c=>{const p=c.target,f=p.files[0];if(t.value=f,p.value="",currentSoundURL){try{URL.revokeObjectURL(currentSoundURL)}catch{}currentSoundURL=""}f&&(currentSoundURL=URL.createObjectURL(f),o.src=currentSoundURL,o.load(),n.state==="suspended"&&n.resume(),o.play())},n=new T,o=document.createElement("audio"),l=n.createMediaElementSource(o),r=n.destination;M(()=>{o.pause(),n.close()}),l.connect(r);const d=n.createChannelSplitter(2),_=n.createAnalyser(),b=n.createAnalyser();l.connect(d),d.connect(_,0),d.connect(b,1),window.audio=o,(()=>currentSoundURL?(o.src=currentSoundURL,o.load(),o.play(),n.resume().then(()=>o.play()).then(()=>!0).catch(c=>(console.error("Cannot auto start: ",c),!1))):Promise.resolve(!1))();const m=new N(_,b);return P(()=>{m.initCanvas(e.value),m.drawFrame()}),{file:t,handleFileSelect:i,canvas:e,painter:m}}}),H={tabindex:"0",role:"button",class:"selectMusic"},X={key:0},Y={key:1},K={class:"options"},W=u("Rotate Figure 45\xB0"),x=u("color shifting "),G=u("deg/sec"),J=u("frame persist "),Q=u("sec"),Z=["value"],ee=s("option",null,"128",-1),te=s("option",null,"256",-1),ne=s("option",null,"512",-1),oe=s("option",null,"1024",-1),se=s("option",null,"2048",-1),ie=s("option",null,"4096",-1),re=s("option",null,"8192",-1),ae=[ee,te,ne,oe,se,ie,re],le=u(" samples per frame "),ue=u("sample from "),he=s("option",null,"wave",-1),de=s("option",{value:"fft"},"fft (just for fun)",-1),ce=[he,de],pe=u(" y = "),fe={key:0},ge=u("log"),me=s("sub",null,"2",-1),ye=u("(1 + x)"),ve=[ge,me,ye],_e={key:1},be=u(" * "),Se=u("gain "),Le={ref:"canvas",width:"800",height:"800"};function we(t,e,i,n,o,l){return v(),y("div",null,[s("label",null,[s("div",H,[t.file?(v(),y("div",X,V(t.file.name),1)):(v(),y("div",Y,"Select Music File"))]),s("input",{type:"file",onChange:e[0]||(e[0]=(...r)=>t.handleFileSelect&&t.handleFileSelect(...r)),accept:"audio/*",style:{display:"none"}},null,32)]),s("div",K,[s("label",null,[g(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=r=>t.painter.rotate45Deg=r)},null,512),[[C,t.painter.rotate45Deg]]),W]),s("label",null,[x,g(s("input",{type:"number",min:"0",max:"100","onUpdate:modelValue":e[2]||(e[2]=r=>t.painter.hueSpeed=r)},null,512),[[w,t.painter.hueSpeed,void 0,{number:!0,lazy:!0}]]),G]),s("label",null,[J,g(s("input",{type:"number",min:"0",max:"5",step:"0.05","onUpdate:modelValue":e[3]||(e[3]=r=>t.painter.fadeInterval=r)},null,512),[[w,t.painter.fadeInterval,void 0,{number:!0,lazy:!0}]]),Q]),s("label",null,[s("select",{onChange:e[4]||(e[4]=r=>t.painter.setFFTSize(+r.target.value)),value:String(t.painter.fftSize)},ae,40,Z),le]),s("label",null,[ue,g(s("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>t.painter.sampleSource=r)},ce,512),[[$,t.painter.sampleSource]])]),s("div",null,[s("label",null,[pe,g(s("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=r=>t.painter.enableLog2=r),onChange:e[7]||(e[7]=(...r)=>t.$forceUpdate&&t.$forceUpdate(...r))},null,544),[[C,t.painter.enableLog2]]),t.painter.enableLog2?(v(),y("span",fe,ve)):(v(),y("span",_e,"x"))]),be,s("label",null,[Se,g(s("input",{type:"number",min:"0",max:"5",step:"0.2","onUpdate:modelValue":e[8]||(e[8]=r=>t.painter.gain=r)},null,512),[[w,t.painter.gain,void 0,{number:!0,lazy:!0}]])])])]),s("canvas",Le,null,512)])}var Ue=q(E,[["render",we]]);window.currentSoundURL="";const Re=B(Ue);Re.mount("#app");
